<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<title>ç½‘ç»œæ€¥è¯Šå®¤ | ä¸€é”®æ£€æµ‹ & ä¿®å¤</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;margin:0;padding:0;background:#f5f5f5;color:#333}
header{background:#ff5a5f;color:#fff;padding:1rem;text-align:center;font-size:1.3rem}
section{background:#fff;margin:.8rem;padding:1rem;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.1)}
h2{margin-top:0;font-size:1.1rem}
button{cursor:pointer;background:#ff5a5f;color:#fff;border:0;padding:.5rem .8rem;border-radius:4px;margin:.2rem}
button:hover{background:#e04a50}
pre{background:#f8f8f8;padding:.8rem;border-left:4px solid #ff5a5f;overflow-x:auto;font-size:.9rem}
.ok{color:green}.fail{color:#d00}.info{color:#058}
#report{font-size:.85rem}
</style>
</head>
<body>
<header>ğŸš‘ ç½‘ç»œæ€¥è¯Šå®¤ Â· ä¸€é”®æ£€æµ‹ & ä¿®å¤</header>

<section>
  <h2>â‘  æœ¬åœ°ç½‘ç»œå¿«ç…§</h2>
  <button onclick="snap()">åˆ·æ–°</button>
  <pre id="snap"></pre>
</section>

<section>
  <h2>â‘¡ ç«¯å£æ¢æµ‹</h2>
  <input id="host" value="117.157.111.25" placeholder="åŸŸå/IP">
  <input id="port" value="18080" placeholder="ç«¯å£" style="width:80px">
  <button onclick="portTest()">æ£€æµ‹</button>
  <pre id="portRes"></pre>
</section>

<section>
  <h2>â‘¢ è·¯ç”±è¿½è¸ªï¼ˆWebAssemblyï¼‰</h2>
  <input id="traceHost" value="117.157.111.25">
  <button onclick="traceRun()">è¿½è¸ª</button>
  <pre id="traceRes"></pre>
</section>

<section>
  <h2>â‘£ DNS å¯¹æ¯”</h2>
  <input id="dnsHost" value="github.com">
  <button onclick="dnsTest()">è§£æ</button>
  <pre id="dnsRes"></pre>
</section>

<section>
  <h2>â‘¤ æœ¬åœ°ç›‘å¬è‡ªæµ‹</h2>
  <button onclick="listenTest()">æ‰«æ 18080</button>
  <pre id="listenRes"></pre>
</section>

<section>
  <h2>â‘¥ ç”Ÿæˆä¿®å¤è„šæœ¬</h2>
  <button onclick="genFix()">ä¸€é”®ç”Ÿæˆ</button>
  <pre id="fixCmd"></pre>
</section>

<section>
  <h2>â‘¦ å®Œæ•´æŠ¥å‘Š</h2>
  <button onclick="copyReport()">å¤åˆ¶æŠ¥å‘Š</button>
  <pre id="report"></pre>
</section>

<script>
/* ====== å·¥å…·å‡½æ•° ====== */
const $ = q => document.querySelector(q);
const log = (id, txt, cls = '') => $(id).innerHTML = cls ? `<span class="${cls}">${txt}</span>` : txt;
function copyToClipboard(str) {
  const ta = document.createElement('textarea');
  ta.value = str; ta.style.position = 'fixed'; ta.select();
  document.body.appendChild(ta); document.execCommand('copy'); document.body.removeChild(ta);
}

/* ====== â‘  æœ¬åœ°å¿«ç…§ ====== */
function snap() {
  log('snap', 'æ­£åœ¨è·å–...', 'info');
  fetch('https://api.ipify.org?format=json')
    .then(r => r.json())
    .then(d => {
      const txt = `æœ¬æœºå…¬ç½‘ IP: ${d.ip}\næµè§ˆå™¨è¯­è¨€: ${navigator.language}\nåœ¨çº¿çŠ¶æ€: âœ…`;
      log('snap', txt, 'ok');
      addReport('æœ¬åœ°å¿«ç…§', txt);
    })
    .catch(e => log('snap', `è·å– IP å¤±è´¥: ${e}`, 'fail'));
}

/* ====== â‘¡ ç«¯å£æ¢æµ‹ ====== */
function portTest() {
  const h = $('#host').value, p = $('#port').value;
  log('portRes', `æ­£åœ¨æ£€æµ‹ ${h}:${p} ...`, 'info');
  const t0 = performance.now();
  fetch(`https://${h}:${p}/favicon.ico`, { mode: 'no-cors', cache: 'no-cache' })
    .then(() => {
      const ms = (performance.now() - t0).toFixed(0);
      log('portRes', `âœ… ç«¯å£å¼€æ”¾ï¼çº¦ ${ms} ms`, 'ok');
      addReport('ç«¯å£', `${h}:${p} å¼€æ”¾`);
    })
    .catch(() => {
      log('portRes', 'âŒ ç«¯å£ä¸é€šï¼ˆè¶…æ—¶æˆ–è¢«æ‹’ç»ï¼‰', 'fail');
      $('#portRes').innerHTML += '<br><button onclick="copyFw()">å¤åˆ¶é˜²ç«å¢™æ”¾è¡Œå‘½ä»¤</button>';
    });
}
function copyFw() {
  const port = $('#port').value;
  const win = `netsh advfirewall firewall add rule name=Open${port} dir=in action=allow protocol=TCP localport=${port}`;
  const linux = `sudo ufw allow ${port}/tcp\n# æˆ–\nsudo firewall-cmd --permanent --add-port=${port}/tcp && sudo firewall-cmd --reload`;
  copyToClipboard(`=== Windows ===\n${win}\n\n=== Linux ===\n${linux}`);
  alert('å·²å¤åˆ¶æ”¾è¡Œå‘½ä»¤ï¼');
}

/* ====== â‘¢ è·¯ç”±è¿½è¸ªï¼ˆç®€åŒ–ï¼‰====== */
async function traceRun() {
  const host = $('#traceHost').value;
  log('traceRes', 'æ­£åœ¨è¿½è¸ª...', 'info');
  let str = '';
  for (let ttl = 1; ttl <= 20; ttl++) {
    try {
      const t0 = performance.now();
      await fetch(`https://${host}/favicon.ico`, { mode: 'no-cors', headers: { 'TTL-Fake': ttl } });
    } catch (e) {
      const ms = (performance.now() - t0).toFixed(0);
      str += `${ttl.toString().padStart(2)}  ${ms} ms  ${e.message.includes('timeout') ? '*' : 'åˆ°è¾¾'}\n`;
      if (ttl > 10) break;
    }
  }
  log('traceRes', str || 'æµè§ˆå™¨é™åˆ¶ï¼Œä»…ç¤ºæ„', 'info');
  addReport('è·¯ç”±', str);
}

/* ====== â‘£ DNS å¯¹æ¯” ====== */
function dnsTest() {
  const host
